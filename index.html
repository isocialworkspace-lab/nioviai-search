<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Niovi AI - Strategic Workspace</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-nav: #0f172a;
            --bg-sidebar: #f8fafc; 
            --bg-chat: #ffffff;
            --text-main: #1e293b;
            --text-secondary: #64748b;
            --accent-blue: #2563eb;
            --border: #e2e8f0;
            --sidebar-width: 320px;
            --nav-width: 80px;
        }

        body { 
            font-family: 'Inter', sans-serif; 
            margin: 0; 
            display: flex; 
            height: 100vh; 
            color: var(--text-main); 
            background: var(--bg-chat);
            overflow: hidden;
        }

        /* Global Navigation */
        .global-nav {
            width: var(--nav-width);
            background: var(--bg-nav);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 24px 0;
            gap: 24px;
            flex-shrink: 0;
            z-index: 50;
        }

        .logo-img {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            margin-bottom: 12px;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            color: #94a3b8;
            border: none;
            background: transparent;
            width: 100%;
            padding: 12px 0;
            transition: all 0.2s;
        }

        .nav-item.active { color: white; }
        .nav-item.active .nav-icon { background: var(--accent-blue); color: white; box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3); }
        
        .nav-icon {
            width: 42px;
            height: 42px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: 0.2s;
        }
        .nav-label { font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; opacity: 0.8; }

        /* Sidebar Drawer */
        .sidebar-drawer {
            width: var(--sidebar-width);
            background: var(--bg-sidebar);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
        }

        .drawer-header { padding: 24px 20px; border-bottom: 1px solid var(--border); background: white; }
        .drawer-content { flex: 1; overflow-y: auto; padding: 16px; }

        /* History Items */
        .history-item {
            padding: 12px 16px;
            margin-bottom: 4px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-main);
            display: flex;
            align-items: center;
            gap: 12px;
            transition: 0.2s;
        }
        .history-item:hover { background: #f1f5f9; }
        .history-item.active { background: #eff6ff; color: var(--accent-blue); }

        /* Hub Tabs */
        .hub-tabs { display: flex; gap: 4px; margin-bottom: 20px; background: #f1f5f9; padding: 4px; border-radius: 10px; }
        .hub-tab-btn { flex: 1; border: none; padding: 8px; font-size: 11px; font-weight: 700; cursor: pointer; color: var(--text-secondary); border-radius: 8px; background: transparent; transition: 0.2s; }
        .hub-tab-btn.active { background: white; color: var(--accent-blue); box-shadow: 0 2px 4px rgba(0,0,0,0.05); }

        /* Memory Train Section */
        .memory-train { margin-bottom: 24px; display: flex; flex-direction: column; gap: 10px; }
        .memory-input { 
            width: 100%; height: 100px; padding: 12px; border: 1px solid var(--border); 
            border-radius: 12px; font-family: inherit; font-size: 13px; resize: none; outline: none;
            box-sizing: border-box;
        }
        .memory-input:focus { border-color: var(--accent-blue); }

        /* Cards */
        .card { 
            background: white; border: 1px solid var(--border); border-radius: 12px; 
            padding: 14px; margin-bottom: 10px; transition: 0.2s;
        }
        .tag { font-size: 9px; font-weight: 800; padding: 3px 8px; border-radius: 6px; text-transform: uppercase; margin-bottom: 8px; display: inline-block; }
        .tag-news { color: #d97706; background: #fef3c7; }
        .tag-memory { color: #2563eb; background: #dbeafe; }
        
        .card-title { font-weight: 700; font-size: 13px; margin: 0 0 6px 0; color: var(--text-main); }
        .card-desc { font-size: 12px; color: var(--text-secondary); line-height: 1.5; }

        /* Chat */
        .main-chat { flex: 1; display: flex; flex-direction: column; background: white; position: relative; }
        #chat-window { flex: 1; overflow-y: auto; padding: 40px 10%; display: flex; flex-direction: column; gap: 20px; }
        
        .message { max-width: 80%; padding: 14px 18px; border-radius: 18px; font-size: 14px; line-height: 1.5; }
        .user { align-self: flex-end; background: var(--accent-blue); color: white; border-bottom-right-radius: 4px; }
        .bot { align-self: flex-start; background: #f1f5f9; color: var(--text-main); border: 1px solid var(--border); border-bottom-left-radius: 4px; }

        .input-area { padding: 20px 10%; border-top: 1px solid var(--border); }
        .input-box { display: flex; gap: 10px; background: #f8fafc; border: 1px solid var(--border); padding: 8px 16px; border-radius: 14px; align-items: center; }
        .input-box input { flex: 1; border: none; background: transparent; outline: none; padding: 8px 0; font-size: 14px; }

        .btn-action { 
            background: var(--accent-blue); color: white; border: none; padding: 10px 20px; border-radius: 10px; 
            cursor: pointer; font-weight: 600; transition: 0.2s; font-size: 13px;
        }
        .btn-action:hover { background: #1d4ed8; }
        .btn-secondary { background: #f1f5f9; color: var(--text-main); border: 1px solid var(--border); }

        .new-chat-btn {
            width: 100%; padding: 12px; border: 1px dashed var(--accent-blue); border-radius: 10px;
            background: #eff6ff; color: var(--accent-blue); font-weight: 600; cursor: pointer;
            margin-bottom: 20px; transition: 0.2s;
        }
    </style>
</head>
<body>

<nav class="global-nav">
    <img src="https://ui-avatars.com/api/?name=N&background=2563eb&color=fff" class="logo-img" alt="Niovi">
    <button class="nav-item active" id="nav-chat" onclick="setTab('chat')">
        <div class="nav-icon">üí¨</div>
        <div class="nav-label">Chat</div>
    </button>
    <button class="nav-item" id="nav-intel" onclick="setTab('intel')">
        <div class="nav-icon">‚ö°</div>
        <div class="nav-label">Intel</div>
    </button>
</nav>

<aside class="sidebar-drawer">
    <div class="drawer-header">
        <h3 id="drawer-title" style="margin:0; font-size:11px; text-transform:uppercase; letter-spacing:1px; color: var(--text-secondary);">Œ£Œ•ŒùŒüŒúŒôŒõŒôŒïŒ£</h3>
    </div>
    <div class="drawer-content" id="drawer-content">
        <!-- Dynamic Content -->
    </div>
</aside>

<main class="main-chat">
    <div id="chat-window"></div>
    <div class="input-area">
        <div class="input-box">
            <input type="text" id="user-input" placeholder="Œ£œÑŒµŒØŒªœÑŒµ Œ≠ŒΩŒ± ŒºŒÆŒΩœÖŒºŒ±..." autocomplete="off">
            <button class="btn-action" onclick="handleSend()">ŒëœÄŒøœÉœÑŒøŒªŒÆ</button>
        </div>
    </div>
</main>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, collection, doc, setDoc, onSnapshot, getDocs, addDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    const firebaseConfig = JSON.parse('{"apiKey":"AIzaSyC6Cp_zMV3T1eggkjLhLmf1q8RuTv9wogE","authDomain":"niovi-ai.firebaseapp.com","projectId":"niovi-ai","storageBucket":"niovi-ai.firebasestorage.app","messagingSenderId":"743828032118","appId":"1:743828032118:web:fea3e038104e1c84b86d57"}');
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const appId = 'niovi_enterprise_v2';

    let user = null;
    let currentChatId = null;
    let currentTab = 'chat';
    let hubSubTab = 'news';
    let localIntel = [];

    const marketNews = [
        { title: "ŒëŒΩŒøŒ¥ŒπŒ∫ŒÆ œÄŒøœÅŒµŒØŒ± œÉœÑŒπœÇ Œ±Œ≥ŒøœÅŒ≠œÇ œÑŒµœáŒΩŒøŒªŒøŒ≥ŒØŒ±œÇ", desc: "ŒüŒπ ŒΩŒ≠ŒµœÇ ŒµŒæŒµŒªŒØŒæŒµŒπœÇ œÉœÑŒø AI œÜŒ≠œÅŒΩŒøœÖŒΩ Œ±ŒπœÉŒπŒøŒ¥ŒøŒæŒØŒ±.", source: "MarketWatch" },
        { title: "ŒùŒ≠Œ± Œ¥ŒµŒ¥ŒøŒºŒ≠ŒΩŒ± œÉœÑŒøŒΩ Œ∫ŒªŒ¨Œ¥Œø œÑŒ∑œÇ ŒµŒΩŒ≠œÅŒ≥ŒµŒπŒ±œÇ", desc: "Œ£Œ∑ŒºŒ±ŒΩœÑŒπŒ∫Œ≠œÇ Œ±ŒªŒªŒ±Œ≥Œ≠œÇ œÉœÑŒπœÇ œÑŒπŒºŒ≠œÇ œÜœÖœÉŒπŒ∫Œøœç Œ±ŒµœÅŒØŒøœÖ.", source: "Reuters" }
    ];

    async function init() {
        if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
            await signInWithCustomToken(auth, __initial_auth_token).catch(() => signInAnonymously(auth));
        } else { await signInAnonymously(auth); }
    }

    onAuthStateChanged(auth, (u) => {
        user = u;
        if (u) {
            setupListeners();
            syncSidebar();
            if (!currentChatId) createNewChat();
        }
    });

    init();

    window.setTab = (tab) => {
        currentTab = tab;
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        document.getElementById(`nav-${tab}`).classList.add('active');
        syncSidebar();
    };

    window.setHubSubTab = (sub) => {
        hubSubTab = sub;
        syncSidebar();
    };

    function syncSidebar() {
        const title = document.getElementById('drawer-title');
        const content = document.getElementById('drawer-content');
        
        if (currentTab === 'chat') {
            title.innerText = "Œ£Œ•ŒùŒüŒúŒôŒõŒôŒïŒ£";
            content.innerHTML = `<button class="new-chat-btn" onclick="createNewChat()">+ ŒùŒ≠Œ± Œ£œÖŒΩŒøŒºŒπŒªŒØŒ±</button><div id="chat-list"></div>`;
            renderChats();
        } else {
            title.innerText = "INTELLIGENCE HUB";
            content.innerHTML = `
                <div class="hub-tabs">
                    <button class="hub-tab-btn ${hubSubTab === 'news' ? 'active' : ''}" onclick="setHubSubTab('news')">News Feed</button>
                    <button class="hub-tab-btn ${hubSubTab === 'memory' ? 'active' : ''}" onclick="setHubSubTab('memory')">Niovi Memory</button>
                </div>
                <div id="hub-container"></div>
            `;
            renderHubContent();
        }
    }

    function renderHubContent() {
        const container = document.getElementById('hub-container');
        if (!container) return;

        if (hubSubTab === 'news') {
            container.innerHTML = marketNews.map(n => `
                <div class="card">
                    <span class="tag tag-news">${n.source}</span>
                    <div class="card-title">${n.title}</div>
                    <div class="card-desc">${n.desc}</div>
                </div>
            `).join('');
        } else {
            container.innerHTML = `
                <div class="memory-train">
                    <textarea id="mem-input" class="memory-input" placeholder="Œ†œÅŒøœÉŒ∏ŒÆŒ∫Œ∑ œÉœÑœÅŒ±œÑŒ∑Œ≥ŒπŒ∫ŒÆœÇ œÄŒªŒ∑œÅŒøœÜŒøœÅŒØŒ±œÇ..."></textarea>
                    <button class="btn-action" onclick="saveToMemory()">ŒëœÄŒøŒ∏ŒÆŒ∫ŒµœÖœÉŒ∑</button>
                </div>
                <div id="memory-list"></div>
            `;
            renderMemoryList();
        }
    }

    function renderMemoryList() {
        const list = document.getElementById('memory-list');
        if (!list) return;
        if (localIntel.length === 0) {
            list.innerHTML = "<p style='font-size:12px; text-align:center; color:#94a3b8; margin-top:20px;'>ŒöŒµŒΩŒÆ ŒºŒΩŒÆŒºŒ∑.</p>";
            return;
        }
        list.innerHTML = localIntel.map(m => `
            <div class="card">
                <span class="tag tag-memory">DATA</span>
                <div class="card-desc">${m.text}</div>
            </div>
        `).join('');
    }

    window.saveToMemory = async () => {
        const input = document.getElementById('mem-input');
        const text = input.value.trim();
        if (!text || !user) return;
        
        try {
            await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'knowledge'), {
                text, timestamp: new Date().toISOString(), userId: user.uid
            });
            input.value = "";
        } catch (e) { console.error(e); }
    };

    function renderChats() {
        onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'sessions'), (snap) => {
            const list = document.getElementById('chat-list');
            if (!list) return;
            list.innerHTML = "";
            snap.forEach(d => {
                const data = d.data();
                const div = document.createElement('div');
                div.className = `history-item ${d.id === currentChatId ? 'active' : ''}`;
                div.innerHTML = `<span>üí¨</span> ${data.title || "Œ£œÖŒΩŒøŒºŒπŒªŒØŒ±"}`;
                div.onclick = () => { currentChatId = d.id; loadChat(d.id); syncSidebar(); };
                list.appendChild(div);
            });
        });
    }

    window.createNewChat = async () => {
        const id = "chat_" + Date.now();
        currentChatId = id;
        document.getElementById('chat-window').innerHTML = "";
        await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'sessions', id), {
            title: "ŒëŒΩŒ¨ŒªœÖœÉŒ∑ " + new Date().toLocaleTimeString('el-GR', {hour:'2-digit', minute:'2-digit'}),
            timestamp: new Date().toISOString()
        });
        appendMessage("ŒìŒµŒπŒ± œÉŒ±œÇ! ŒïŒØŒºŒ±Œπ Œ∑ Niovi. Œ†œéœÇ ŒºœÄŒøœÅœé ŒΩŒ± œÉŒ±œÇ Œ≤ŒøŒ∑Œ∏ŒÆœÉœâ œÉŒÆŒºŒµœÅŒ±;", "bot");
    };

    window.handleSend = async () => {
        const input = document.getElementById('user-input');
        const text = input.value.trim();
        if (!text || !user) return;

        appendMessage(text, 'user');
        input.value = "";

        try {
            const memText = localIntel.map(i => i.text).join(". ");
            const newsText = marketNews.map(n => n.title).join(". ");
            
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: text }] }],
                    systemInstruction: { parts: [{ text: `ŒïŒØœÉŒ±Œπ Œ∑ Niovi AI. ŒëœÄŒ¨ŒΩœÑŒ± ŒºœåŒΩŒø œÉŒµ œå,œÑŒπ œÉŒµ œÅœâœÑŒ¨ŒΩŒµ. ŒúŒóŒù Œ±ŒΩŒ±œÜŒ≠œÅŒµŒπœÇ Œ¥ŒµŒ¥ŒøŒºŒ≠ŒΩŒ± Œ±ŒΩ Œ¥ŒµŒΩ ŒµŒØŒΩŒ±Œπ œÉœáŒµœÑŒπŒ∫Œ¨. DATA: ${memText} | NEWS: ${newsText}` }] }
                })
            });
            const data = await response.json();
            const reply = data.candidates?.[0]?.content?.parts?.[0]?.text || "Œ£œÜŒ¨ŒªŒºŒ± AI.";
            appendMessage(reply, 'bot');
        } catch (e) { appendMessage("Œ£œÜŒ¨ŒªŒºŒ± œÉœçŒΩŒ¥ŒµœÉŒ∑œÇ.", "bot"); }
    };

    function appendMessage(text, role) {
        const win = document.getElementById('chat-window');
        const div = document.createElement('div');
        div.className = `message ${role}`;
        div.innerText = text;
        win.appendChild(div);
        win.scrollTop = win.scrollHeight;
    }

    function setupListeners() {
        onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'knowledge'), (snap) => {
            localIntel = [];
            snap.forEach(d => localIntel.push(d.data()));
            if (currentTab === 'intel' && hubSubTab === 'memory') renderMemoryList();
        });
    }

    async function loadChat(id) {
        document.getElementById('chat-window').innerHTML = "";
        appendMessage("Œ¶œåœÅœÑœâœÉŒ∑ ŒπœÉœÑŒøœÅŒπŒ∫Œøœç...", "bot");
        // ŒïŒ¥œé Œ∏Œ± ŒºœÄŒøœÅŒøœçœÉŒµ ŒΩŒ± ŒºœÄŒµŒπ Œ∑ ŒªŒøŒ≥ŒπŒ∫ŒÆ œÜœåœÅœÑœâœÉŒ∑œÇ ŒºŒ∑ŒΩœÖŒºŒ¨œÑœâŒΩ Œ±œÄœå Firestore
    }

    document.getElementById('user-input').addEventListener('keypress', e => { if (e.key === 'Enter') handleSend(); });
</script>
</body>
</html>
