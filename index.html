<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Niovi AI - Strategic Copilot</title>
    <style>
        :root {
            --bg-color: #f8f9fa;
            --sidebar-bg: #ffffff;
            --text-main: #1a1a1a;
            --accent: #000000;
            --border: #e5e5ea;
        }

        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background-color: var(--bg-color); margin: 0; display: flex; height: 100vh; color: var(--text-main); }

        .sidebar { width: 340px; background-color: var(--sidebar-bg); border-right: 1px solid var(--border); display: flex; flex-direction: column; padding: 30px 20px; box-sizing: border-box; }
        
        .profile-frame { width: 90px; height: 90px; border-radius: 50%; overflow: hidden; margin: 0 auto 15px; border: 2px solid var(--border); box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .profile-frame img { width: 100%; height: 100%; object-fit: cover; }
        .persona-name { font-size: 18px; font-weight: 700; text-align: center; margin: 0; }

        .status-badge { margin-top: 15px; padding: 8px; border-radius: 10px; font-size: 11px; text-align: center; background: #f3f4f6; border: 1px solid var(--border); transition: all 0.3s ease; }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 5px; background: #9ca3af; }
        .active-dot { background: #10b981; box-shadow: 0 0 8px #10b981; }

        .main-chat { flex: 1; display: flex; flex-direction: column; position: relative; background: #fff; }
        #chat-window { flex: 1; overflow-y: auto; padding: 40px 10%; display: flex; flex-direction: column; gap: 20px; }
        
        .message { max-width: 85%; padding: 14px 20px; font-size: 15px; line-height: 1.6; border-radius: 18px; animation: fadeIn 0.3s ease; }
        .user { align-self: flex-end; background-color: var(--accent); color: #fff; border-bottom-right-radius: 4px; }
        .bot { align-self: flex-start; background-color: #f1f2f6; color: #1a1a1a; border-bottom-left-radius: 4px; }
        
        .error-card { background: #fff5f5; border: 1px solid #feb2b2; color: #c53030; padding: 15px; border-radius: 10px; font-size: 13px; margin: 10px 0; font-family: monospace; white-space: pre-wrap; }

        .input-container { padding: 25px 10%; border-top: 1px solid var(--border); background: #fff; }
        .input-wrapper { display: flex; gap: 10px; background: #f8f9fa; padding: 8px 15px; border-radius: 30px; border: 1px solid var(--border); }
        input { flex: 1; border: none; background: transparent; outline: none; font-size: 15px; padding: 8px; }
        .send-btn { background: var(--accent); color: #fff; border: none; padding: 8px 20px; border-radius: 20px; cursor: pointer; font-weight: 600; }
        .send-btn:disabled { opacity: 0.5; cursor: not-allowed; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="profile-frame">
        <img src="https://ui-avatars.com/api/?name=Niovi+Christopoulou&background=000&color=fff&size=128" alt="Niovi">
    </div>
    <h1 class="persona-name">Νιόβη Χριστοπούλου</h1>
    
    <div class="status-badge" id="status-badge">
        <span id="status-dot" class="status-dot"></span>
        <span id="status-text">Ανίχνευση Μοντέλου...</span>
    </div>

    <div style="margin-top:auto; font-size: 12px; line-height: 1.4; color: #444; background: #f0f7ff; padding: 15px; border-radius: 10px; border: 1px solid #d0e3ff;">
        <strong>Smart Discovery Active:</strong> <br>
        Αν το 'gemini-1.5-flash' δεν είναι διαθέσιμο στο v1, το σύστημα θα δοκιμάσει αυτόματα το 'gemini-pro' ή την έκδοση v1beta.
    </div>
</div>

<div class="main-chat">
    <div id="chat-window">
        <div class="message bot">
            <strong>Σύστημα Niovi AI</strong><br>
            Προσπαθώ να συνδεθώ με το βέλτιστο διαθέσιμο μοντέλο για το κλειδί σας. <br><br>
            Αν δείτε το 'Ready' αριστερά, μπορείτε να στείλετε μήνυμα.
        </div>
    </div>
    
    <div class="input-container">
        <div class="input-wrapper">
            <input type="text" id="user-input" placeholder="Αρχικοποίηση..." disabled>
            <button class="send-btn" id="send-btn" onclick="handleSend()" disabled>Αποστολή</button>
        </div>
    </div>
</div>

<script>
    const API_KEY = "AIzaSyB4Oo2I7dzoYuQdWQs6OuMyJMYn8Bwiljc"; 
    let activeEndpoint = "v1beta"; // Ξεκινάμε με v1beta που είναι πιο ευέλικτο
    let selectedModel = null;
    
    const chatWindow = document.getElementById('chat-window');
    const userInput = document.getElementById('user-input');
    const sendBtn = document.getElementById('send-btn');
    const statusDot = document.getElementById('status-dot');
    const statusText = document.getElementById('status-text');

    async function discoverModel() {
        const endpoints = ["v1beta", "v1"];
        
        for (let env of endpoints) {
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/${env}/models?key=${API_KEY}`);
                const data = await response.json();
                
                if (data.models) {
                    // Ψάχνουμε μοντέλο που υποστηρίζει generateContent
                    const viableModel = data.models.find(m => 
                        m.supportedGenerationMethods.includes("generateContent") && 
                        (m.name.includes("flash") || m.name.includes("pro"))
                    );

                    if (viableModel) {
                        activeEndpoint = env;
                        selectedModel = viableModel.name;
                        statusDot.classList.add('active-dot');
                        statusText.innerText = selectedModel.split('/').pop() + " (" + env + ")";
                        userInput.disabled = false;
                        userInput.placeholder = "Ρωτήστε τη Νιόβη...";
                        sendBtn.disabled = false;
                        return true;
                    }
                }
            } catch (e) {
                console.warn(`Failed to discover models in ${env}`);
            }
        }
        
        appendError("Δεν βρέθηκε κανένα διαθέσιμο μοντέλο. Παρακαλώ ελέγξτε αν το κλειδί σας έχει ενεργοποιηθεί στο Google Cloud Console.");
        return false;
    }

    discoverModel();

    async function handleSend() {
        const query = userInput.value.trim();
        if (!query || !selectedModel) return;

        appendMessage(query, 'user');
        userInput.value = "";
        userInput.disabled = true;
        sendBtn.disabled = true;

        // Δυναμικό URL βασισμένο στην ανίχνευση
        const url = `https://generativelanguage.googleapis.com/${activeEndpoint}/${selectedModel}:generateContent?key=${API_KEY}`;

        try {
            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: `Είσαι η Νιόβη Χριστοπούλου, Strategic Copilot. Απάντησε στα ελληνικά: ${query}` }] }]
                })
            });

            const data = await response.json();

            if (data.error) {
                appendError(data.error.message);
            } else if (data.candidates && data.candidates[0].content.parts[0].text) {
                appendMessage(data.candidates[0].content.parts[0].text, 'bot');
            }
        } catch (e) {
            appendError("Σφάλμα σύνδεσης: " + e.message);
        } finally {
            userInput.disabled = false;
            sendBtn.disabled = false;
            userInput.focus();
        }
    }

    function appendMessage(text, side) {
        const msg = document.createElement('div');
        msg.className = `message ${side}`;
        msg.innerHTML = text.replace(/\n/g, '<br>').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
        chatWindow.appendChild(msg);
        chatWindow.scrollTop = chatWindow.scrollHeight;
    }

    function appendError(text) {
        const err = document.createElement('div');
        err.className = 'error-card';
        err.innerHTML = `<strong>System Status:</strong> ${text}`;
        chatWindow.appendChild(err);
        chatWindow.scrollTop = chatWindow.scrollHeight;
    }

    userInput.addEventListener('keypress', (e) => { if (e.key === 'Enter' && !sendBtn.disabled) handleSend(); });
</script>

</body>
</html>
